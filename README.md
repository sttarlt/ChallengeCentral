# منصة مسابقاتي

منصة "مسابقاتي" هي منصة متكاملة لإدارة المسابقات مصممة للمشرفين والمستخدمين باللغة العربية.

## المكونات الرئيسية

- نظام مصادقة متقدم مع تحكم دقيق بالصلاحيات
- واجهة إدارية آمنة ومرنة
- دعم متعدد اللغات مع التركيز على العربية
- نظام دردشة وتواصل مدمج
- أدوات متقدمة لإدارة المسابقات وتتبع الكربتو
- نظام باقات الكربتو مع خيارات شراء متنوعة

## تشغيل المشروع

1. تأكد من تثبيت Python 3.8 أو أحدث
2. قم بتثبيت المتطلبات:
   ```
   pip install -r requirements.txt
   ```
3. قم بتشغيل الخادم:
   ```
   gunicorn --bind 0.0.0.0:5000 --reuse-port main:app
   ```

## إدارة باقات الكربتو

تم إضافة نظام باقات الكربتو لتمكين المستخدمين من شراء رصيد الكربتو. تتم إدارة هذه الباقات من خلال لوحة تحكم المشرف.

### إضافة أو تعديل باقات الكربتو

1. سجل الدخول كمشرف
2. انتقل إلى `لوحة تحكم المشرف > باقات الكربتو`
3. اضغط على `إضافة باقة جديدة` لإضافة باقة جديدة
4. املأ النموذج بالمعلومات المطلوبة:
   - اسم الباقة: اسم وصفي للباقة (مثال: "الباقة الأساسية")
   - السعر: سعر الباقة بالدولار (مثال: 1.00)
   - الكربتو: عدد الكربتو التي سيحصل عليها المستخدم (مثال: 100)
   - وصف مختصر: وصف اختياري للباقة
   - نشط: حالة الباقة (نشطة أو غير نشطة)
   - ترتيب العرض: رقم لتحديد ترتيب ظهور الباقة (الأرقام الأصغر تظهر أولاً)
5. اضغط على `حفظ الباقة`

### تعديل رابط التواصل للشراء

رابط التواصل هو الرابط الذي سيتم توجيه المستخدمين إليه عند الضغط على زر "تواصل للشراء" في صفحة باقات الكربتو.

1. سجل الدخول كمشرف
2. انتقل إلى `لوحة تحكم المشرف > الإعدادات`
3. قم بتعديل `رابط التواصل للشراء` (يمكن استخدام روابط واتساب، تلغرام، إلخ)
4. اضغط على `حفظ الإعدادات`

#### أمثلة على روابط التواصل المدعومة:

- رابط واتساب: `https://wa.me/رقم_الهاتف`
- رابط تلغرام: `https://t.me/اسم_المستخدم`
- رابط فيسبوك ماسنجر: `https://m.me/اسم_المستخدم_أو_المعرف`
- بريد إلكتروني: `mailto:عنوان_البريد_الإلكتروني`

### إعادة تهيئة الباقات الافتراضية

إذا كنت ترغب في إعادة تهيئة باقات الكربتو إلى القيم الافتراضية، يمكنك تشغيل:

```
python create_default_packages.py
```

هذا السكريبت سيقوم بحذف جميع الباقات الحالية وإنشاء 3 باقات افتراضية:
- باقة أساسية: 1$ = 100 كربتو
- باقة قياسية: 5$ = 600 كربتو
- باقة متميزة: 10$ = 1300 كربتو

## إدارة المسابقات

تتيح المنصة للمشرفين إنشاء وإدارة المسابقات من خلال لوحة التحكم.

### إنشاء مسابقة جديدة

1. سجل الدخول كمشرف
2. انتقل إلى `لوحة تحكم المشرف > المسابقات`
3. اضغط على `إضافة مسابقة جديدة`
4. املأ النموذج بالمعلومات المطلوبة:
   - عنوان المسابقة: عنوان وصفي للمسابقة
   - وصف المسابقة: تفاصيل ومعلومات عن المسابقة وقواعدها
   - الكربتو: عدد نقاط الكربتو التي يمكن كسبها من المسابقة
   - تاريخ البدء: توقيت بدء المسابقة
   - تاريخ الانتهاء: توقيت انتهاء المسابقة
   - نشط: حالة المسابقة (نشطة أو غير نشطة)
5. اضغط على `حفظ المسابقة`

### تعديل مسابقة موجودة

1. سجل الدخول كمشرف
2. انتقل إلى `لوحة تحكم المشرف > المسابقات`
3. ابحث عن المسابقة في القائمة واضغط على زر `تعديل`
4. قم بتعديل المعلومات المطلوبة
5. اضغط على `حفظ المسابقة`

### التعامل مع حالات الخطأ

- في حالة عدم وجود مسابقة بالرقم المطلوب، سيتم عرض رسالة "لم يتم العثور على المسابقة المطلوبة" وإعادة توجيه المستخدم إلى صفحة المسابقات الرئيسية.
- في حالة حدوث أي خطأ آخر، سيتم عرض رسالة خطأ عامة وتسجيل تفاصيل الخطأ في سجل الخادم للمتابعة.

## نظام تحدي الصديق (الإحالة)

تتيح المنصة للمستخدمين دعوة أصدقائهم والحصول على مكافآت كربتو. يتم ذلك من خلال نظام الإحالة المتكامل.

### مزايا النظام

- لكل إحالة ناجحة (عندما يسجل صديق جديد عبر الرابط): 5 كربتو
- لكل 5 إحالات مجمعة: مكافأة إضافية 10 كربتو
- لكل 10 إحالات مجمعة: مكافأة إضافية 20 كربتو
- المستخدم الجديد الذي يسجل عبر رابط الإحالة: مكافأة ترحيبية 2 كربتو
- الحد الأقصى الشهري للمكافآت: 500 كربتو
- الحد الأقصى الإجمالي للمكافآت: 1000 كربتو

### تعديل نظام الإحالة

تتم إدارة إعدادات نظام الإحالة من خلال ملف `config.py` الذي يحتوي على المتغيرات التالية:

```python
# مكافأة لكل إحالة ناجحة (عندما يسجل صديق جديد)
REFERRAL_REWARD_PER_FRIEND = 5

# مكافأة ترحيبية للمستخدم الجديد عند التسجيل عبر رابط إحالة
REFERRAL_WELCOME_BONUS = 2

# المكافآت الإضافية عند الوصول لعدد معين من الإحالات
REFERRAL_MILESTONE_REWARDS = {
    5: 10,   # 5 إحالات = 10 كربتو إضافية
    10: 20,  # 10 إحالات = 20 كربتو إضافية
}

# الحد الأقصى للكربتو من الإحالات شهرياً
REFERRAL_MONTHLY_LIMIT = 500

# الحد الأقصى للكربتو من الإحالات بشكل إجمالي
REFERRAL_TOTAL_LIMIT = 1000
```

لتعديل هذه القيم:
1. قم بفتح ملف `config.py`
2. قم بتعديل القيم حسب الحاجة
3. أعد تشغيل الخادم لتطبيق التغييرات

### تعديل رابط الإحالة

روابط الإحالة تعتمد على كود فريد لكل مستخدم يتم توليده تلقائياً عند التسجيل أو عند زيارة صفحة تحدي الصديق لأول مرة. 

تنسيق رابط الإحالة هو:
```
https://example.com/invite?ref=CODE
```

حيث `CODE` هو كود الإحالة الفريد للمستخدم.

إذا كنت ترغب في تغيير تنسيق الرابط:
1. قم بتعديل الدالة `get_referral_url` في نموذج `User` في ملف `models.py`
2. قم بتعديل المسار `/invite` في ملف `routes.py` ليتناسب مع التنسيق الجديد

## مستخدم المشرف الافتراضي

- البريد الإلكتروني: admin@example.com
- كلمة المرور: admin123