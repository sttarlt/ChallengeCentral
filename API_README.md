# واجهة برمجة التطبيقات (API) لمنصة مسابقاتي

## نظرة عامة

توفر واجهة برمجة التطبيقات (API) الخاصة بمنصة مسابقاتي وصولًا آمنًا لبيانات المستخدمين والميزات الأساسية للمنصة. تم تصميم API مع وضع الأمان والأداء والاستقرار في الاعتبار، مما يتيح للمطورين دمج وظائف المنصة في تطبيقاتهم الخاصة.

## الميزات الرئيسية

- **التوثيق بمفاتيح API**: نظام آمن للتحقق من الهوية باستخدام مفاتيح API مخصصة لكل مستخدم.
- **تأمين النقاط النهاية**: حماية كاملة لجميع نقاط النهاية مع تحديد الصلاحيات المناسبة.
- **تحديد معدل الطلبات**: حماية من الاستخدام المفرط للخدمة باستخدام تقنيات تحديد معدل الطلبات لكل مستخدم وعنوان IP.
- **تنسيق JSON**: جميع البيانات يتم تبادلها بتنسيق JSON سهل الاستخدام.
- **التوثيق الشامل**: توثيق كامل لجميع نقاط النهاية وكيفية استخدامها.
- **تسجيل العمليات الحساسة**: تسجيل جميع العمليات الحساسة في سجل التدقيق لاكتشاف النشاط غير المصرح به.
- **التصفيف الإصداري**: استخدام تصفيف الإصدارات (/api/v1/) لضمان توافق التطبيقات المستقبلية.

## البدء

### إعداد

1. **الحصول على مفتاح API**:
   - قم بتسجيل الدخول إلى حسابك على منصة مسابقاتي.
   - انتقل إلى صفحة "واجهة برمجة التطبيقات" من القائمة الرئيسية.
   - انقر على "إنشاء مفتاح جديد" واختر الصلاحيات المناسبة.
   - احفظ المفتاح الناتج في مكان آمن - لن يتم عرضه مرة أخرى!

2. **استخدام المفتاح في الطلبات**:
   - يجب إرسال المفتاح في رأس كل طلب HTTP باستخدام `Authorization: Bearer YOUR_API_KEY`.

### عنوان API الأساسي

جميع نقاط النهاية متوفرة على العنوان التالي:

```
https://musabaqati.com/api/v1/
```

## التوثيق بمفاتيح API

### أنواع الصلاحيات

- **قراءة فقط (read)**: وصول للقراءة فقط للبيانات (الافتراضي).
- **قراءة وكتابة (write)**: وصول للقراءة والكتابة (محدود لبعض العمليات).
- **مشرف (admin)**: صلاحيات كاملة (متاح للمشرفين فقط).

### صلاحية المفتاح

يمكن إنشاء مفاتيح API بفترات صلاحية مختلفة (30 يومًا، 90 يومًا، 180 يومًا، سنة، أو بدون انتهاء).

### إدارة المفاتيح

يمكن للمستخدمين إدارة مفاتيحهم (إنشاء، تعطيل) من خلال واجهة المستخدم أو عبر نقاط نهاية API المخصصة.

## نقاط النهاية المتاحة

### الصحة والتوفر

```
GET /api/v1/health
```

تستخدم للتحقق من توفر خدمة API وحالتها.

استجابة نموذجية:
```json
{
  "status": "ok",
  "version": "1.0",
  "timestamp": 1683824765
}
```

### معلومات المستخدم

```
GET /api/v1/user/info
```

تسترجع معلومات أساسية عن المستخدم الحالي.

استجابة نموذجية:
```json
{
  "status": "success",
  "data": {
    "id": 123,
    "username": "ahmed_88",
    "points": 750,
    "referral_code": "REF123456",
    "total_referrals": 12,
    "created_at": "2023-01-15T14:30:45Z"
  }
}
```

### رصيد النقاط

```
GET /api/v1/user/points
```

تسترجع رصيد نقاط المستخدم الحالي.

استجابة نموذجية:
```json
{
  "status": "success",
  "data": {
    "points": 750,
    "timestamp": 1683824765
  }
}
```

### سجل المعاملات

```
GET /api/v1/user/transactions?limit=10&offset=0
```

تسترجع سجل معاملات النقاط للمستخدم.

معلمات الاستعلام:
- `limit`: عدد السجلات المطلوبة (الافتراضي: 10، الحد الأقصى: 50)
- `offset`: تخطي عدد معين من السجلات للتصفح (الافتراضي: 0)

استجابة نموذجية:
```json
{
  "status": "success",
  "data": [
    {
      "id": 456,
      "amount": 100,
      "balance_after": 750,
      "transaction_type": "reward",
      "description": "مكافأة إكمال المسابقة",
      "created_at": "2023-05-10T18:30:45Z"
    },
    {
      "id": 455,
      "amount": -50,
      "balance_after": 650,
      "transaction_type": "redemption",
      "description": "استبدال جائزة",
      "created_at": "2023-05-08T14:22:30Z"
    }
  ],
  "metadata": {
    "limit": 10,
    "offset": 0,
    "count": 2
  }
}
```

### الإحالات

```
GET /api/v1/referrals?limit=10&offset=0
```

تسترجع قائمة المستخدمين الذين تمت إحالتهم بواسطة المستخدم الحالي.

معلمات الاستعلام:
- `limit`: عدد السجلات المطلوبة (الافتراضي: 10، الحد الأقصى: 50)
- `offset`: تخطي عدد معين من السجلات للتصفح (الافتراضي: 0)

استجابة نموذجية:
```json
{
  "status": "success",
  "data": [
    {
      "id": 789,
      "referred_user": {
        "id": 456,
        "username": "sara_92"
      },
      "status": "verified",
      "reward_paid": true,
      "reward_amount": 5,
      "created_at": "2023-05-01T10:15:20Z"
    }
  ],
  "metadata": {
    "limit": 10,
    "offset": 0,
    "count": 1,
    "total_referrals": 12
  }
}
```

### المكافآت المتاحة

```
GET /api/v1/rewards?limit=10&offset=0
```

تسترجع قائمة المكافآت المتاحة حاليًا في المنصة.

معلمات الاستعلام:
- `limit`: عدد السجلات المطلوبة (الافتراضي: 10، الحد الأقصى: 50)
- `offset`: تخطي عدد معين من السجلات للتصفح (الافتراضي: 0)

استجابة نموذجية:
```json
{
  "status": "success",
  "data": [
    {
      "id": 123,
      "name": "بطاقة آيتونز بقيمة $10",
      "description": "بطاقة هدية آيتونز بقيمة 10 دولار أمريكي",
      "points_required": 500,
      "quantity": 15
    },
    {
      "id": 124,
      "name": "بطاقة بلايستيشن بقيمة $20",
      "description": "بطاقة هدية بلايستيشن بقيمة 20 دولار أمريكي",
      "points_required": 1000,
      "quantity": 8
    }
  ],
  "metadata": {
    "limit": 10,
    "offset": 0,
    "count": 2
  }
}
```

### إدارة مفاتيح API

#### قائمة المفاتيح الحالية

```
GET /api/v1/keys
```

تسترجع قائمة مفاتيح API للمستخدم الحالي (مع إخفاء المفتاح الكامل).

استجابة نموذجية:
```json
{
  "status": "success",
  "data": [
    {
      "id": 123,
      "name": "تطبيق الجوال",
      "key": "msb_5a7b...9f4d",
      "permissions": "read",
      "is_active": true,
      "usage_count": 45,
      "last_used_at": "2023-05-11T08:45:30Z",
      "created_at": "2023-04-15T10:30:00Z",
      "expires_at": "2024-04-15T10:30:00Z"
    }
  ]
}
```

#### إنشاء مفتاح جديد

```
POST /api/v1/keys
```

إنشاء مفتاح API جديد.

طلب نموذجي:
```json
{
  "name": "تطبيق الويب",
  "permissions": "read",
  "expires_days": 365
}
```

استجابة نموذجية:
```json
{
  "status": "success",
  "data": {
    "id": 124,
    "key": "msb_7c8d9e0f1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t1u2v3w4x5y6z",
    "name": "تطبيق الويب",
    "permissions": "read",
    "is_active": true,
    "created_at": "2023-05-11T09:15:30Z",
    "expires_at": "2024-05-11T09:15:30Z"
  },
  "message": "تم إنشاء المفتاح بنجاح. يرجى الاحتفاظ بالمفتاح الكامل، لن يتم عرضه مرة أخرى."
}
```

#### إلغاء تنشيط مفتاح

```
DELETE /api/v1/keys/{key_id}
```

إلغاء تنشيط مفتاح API موجود.

استجابة نموذجية:
```json
{
  "status": "success",
  "message": "تم إلغاء تنشيط المفتاح بنجاح"
}
```

## معالجة الأخطاء

جميع الأخطاء تتبع تنسيق موحد:

```json
{
  "status": "error",
  "error": "رسالة الخطأ هنا"
}
```

### رموز حالة HTTP

- `200 OK`: تم تنفيذ الطلب بنجاح
- `201 Created`: تم إنشاء الكائن بنجاح
- `400 Bad Request`: الطلب غير صالح
- `401 Unauthorized`: فشل التوثيق
- `403 Forbidden`: التوثيق نجح، ولكن المستخدم لا يملك الصلاحية
- `404 Not Found`: الكائن المطلوب غير موجود
- `429 Too Many Requests`: تم تجاوز معدل الطلبات المسموح به
- `500 Internal Server Error`: حدث خطأ داخلي في الخادم

## التعامل مع CORS

يتم تطبيق سياسة Cross-Origin Resource Sharing (CORS) للسماح فقط لنطاقات محددة بالوصول إلى API الخاصة بنا. يتم تعيين هذه النطاقات في إعدادات النظام.

## حماية معدل الطلبات

لمنع سوء استخدام API، تم تطبيق حدود لمعدل الطلبات على كل نقطة نهاية. تختلف هذه الحدود حسب نوع العملية، على سبيل المثال:

- عمليات القراءة: 60 طلب في الدقيقة
- عمليات الكتابة: 30 طلب في الدقيقة
- إنشاء المفاتيح: 5 طلبات في الساعة

## أفضل الممارسات

1. احتفظ بمفتاح API في مكان آمن ولا تشاركه أبدًا.
2. استخدم HTTPS دائمًا عند التواصل مع API الخاصة بنا.
3. تعامل مع الأخطاء بشكل صحيح في تطبيقك.
4. احترم حدود معدل الطلبات وقم بتطبيق التأخير بين المحاولات عند الحاجة.
5. قم بتنفيذ آلية تخزين مؤقت للبيانات التي لا تتغير بشكل متكرر.

## الدعم والمساعدة

إذا كنت بحاجة إلى مساعدة أو لديك أسئلة حول استخدام API، يمكنك التواصل معنا عبر:

- البريد الإلكتروني: support@musabaqati.com
- رابط التواصل: https://t.me/oo_1oo4

## التغييرات المستقبلية

سيتم الإعلان عن أي تغييرات مهمة في API قبل تنفيذها، وسيتم الحفاظ على دعم الإصدارات السابقة لفترة زمنية معقولة.